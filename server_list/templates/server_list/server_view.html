{% extends 'server_list/navbar.html' %}
{% load server_list_extras %}

{% block title %}Карточка сервера{% endblock %}

{% block style %}
.spoiler-trigger{
color: #0b70db;
text-decoration: none;
}

.spoiler-trigger>span{
border-bottom: 1px dashed #0b70db;
padding:0 3px;
}
.spoiler-trigger:hover>span{
border-bottom-style: solid;
}
.spoiler-block{
display: none;
}
{% endblock %}

{% block otherscript %}{% endblock %}

{% block script %}
$(document).on('click','.spoiler-trigger',function(e){
e.preventDefault();
if (!$(this).hasClass('active')){
$(".spoiler-trigger").empty().append($('<span></span>').text('Скрыть пароли'));
$.ajax({
url: "{% url 'ajax' %}",
type: 'GET',
data: {'model': 'server', 'server_id': '{{server_dict|get_dict_item:"server_id"}}'},
dataType: "text",
success: function(resp){
console.log(resp)
$(".spoiler-block").text(resp)

},
error: function(jqXHR, textStatus, errorThrown) {
console.log(errorThrown)
}
});
}else{
$(".spoiler-trigger").empty().append($('<span></span>').text('Показать пароли'));
}
$('.spoiler-block').slideToggle(300);
$(this).toggleClass('active');

})

{% endblock %}

{% block content %}
<div class="container">
    <header>
        <h1>Сервер: {{ server_dict|get_dict_item:"hostname" }}
            {% if server_dict|get_dict_item:"power_state" %}|
            <font color="green">On</font>
            {% else %}
            <font color="red">Off</font>
            {%endif%}
        </h1>
        <h2>
            {% if server_dict|get_dict_item:"is_physical" %}
            <p>Физический сервер</p>
            {%else%}
            <p>Виртуальная машина на <a href="{% url 'server_view' server_dict|get_dict_item:'host_machine_id' %}">{{server_dict|get_dict_item:"host_machine"}}</a>
            </p>
            {%endif%}
        </h2>
    </header>

    {% for ip in server_dict|get_dict_item:"root_ip_list" %}
    <p>Сегмент: <a href="{%url 'list'%}?segment={{ip.segment.id}}">{{ip.segment}}</a></p>
    {% endfor %}
    <p>Назначение: {{server_dict|get_dict_item:"purpose"}}</p>
    <p>Операционная система: {{server_dict|get_dict_item:"os"}}</p>
    {% if server_dict|get_dict_item:"is_physical" %}
    <p>Расположен: <a href="{% url 'territory_view' server_dict.territory.id %} ">{{server_dict.territory.name}}</a>,
        <a href="{% url 'room_view' server_dict.room.id %} ">{{server_dict.room.name}}</a>,
        <a href="{% url 'rack_view' server_dict.rack.id  %}">{{server_dict.rack.name}}, unit
            {{server_dict|get_dict_item:"unit"}}</a></p>
    {%endif%}
    {% for ip in server_dict|get_dict_item:"ip_list"%}
    <p>{{ip.0}} : {{ip.1}}</p>
    {% endfor %}
    {% if server_dict|get_dict_item:"is_physical" %}
    <!--<p>Характеристики:</p>-->
    <p>Модель: {{server_dict|get_dict_item:"model"}}</p>
    <p>Серийный номер: {{server_dict|get_dict_item:"serial_number"}}</p>
    <p>Железо: {{server_dict|get_dict_item:"specs"}}</p>
    {% endif %}
    </p><a href="#" class="spoiler-trigger"><span>Показать пароли</span></a>
    <div class="spoiler-block" style="display:none">Ошибка</div>
    {% if server_dict|get_dict_item:"vm_list" %}
    <p>Виртуальные машины:</p>
    {% endif %}
    {% for s in server_dict|get_dict_item:"vm_list"%}
    <p><a href="{% url 'server_view' s.id %}">{{s.hostname}}</a></p>
    {% endfor %}
    <p><a href="{% url 'server_edit' server_dict|get_dict_item:'server_id'%}">Редактировать</a></p>

</div>
{% endblock %}
