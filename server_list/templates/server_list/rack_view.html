<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Карточка стойки</title>
    <script>
        function draw(){
            console.log(window.innerWidth, window.innerHeight);
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");

            var windowWidth = Math.round(window.innerWidth/2);
            var windowHeight = window.innerHeight-100;
            ctx.canvas.width = windowWidth;
            ctx.canvas.height = windowHeight;
            ctx.fillStyle = "#FF0000";

            var rackWidth = Math.round(windowWidth*.3);
            var rackGap = Math.round(windowWidth*.1);
            var horMargin = 0.5+(windowWidth-rackWidth*2-rackGap)/2;
            var verMargin = 0.5+Math.round(windowHeight*.15);
            var rackHeight = windowHeight-2*verMargin;

            ctx.lineWidth = 1;

            ctx.strokeRect(horMargin, verMargin, rackWidth, rackHeight);
            ctx.strokeRect(horMargin+rackWidth+rackGap, verMargin, rackWidth, rackHeight);

            var rackSize = {{rack.size}};
            var front = { {% for t, v in front.items %} "{{t}}":{{v}}{%if not forloop.last%},{% endif %}{% endfor %} };
            var back = { {% for t, v in back.items %} "{{t}}":{{v}}{%if not forloop.last%},{% endif %}{% endfor %} };


            var unitHeight = rackHeight/rackSize;

            for (var i = 1; i<rackSize; i++){
                y = 0.5+Math.round(verMargin + unitHeight * i);
                ctx.beginPath();
                ctx.moveTo(horMargin, y);
                ctx.lineTo(horMargin + rackWidth, y);
                ctx.stroke();
                ctx.moveTo(horMargin + rackWidth + rackGap, y);
                ctx.lineTo(horMargin + rackWidth * 2 + rackGap, y);
                ctx.stroke();
                ctx.closePath();
            }
            ctx.font = rackHeight-2 + " Arial";
            for (var server in front){
                ctx.fillStyle= "#FF0000";
                ctx.fillRect(horMargin,  0.5+Math.round(verMargin + unitHeight*(front[server][0]-1)), rackWidth, 0.5+Math.round(unitHeight*front[server][1]));
                ctx.fillStyle = "black"
                ctx.fillText(server,horMargin+rackWidth/2, 0.5+Math.round(verMargin + unitHeight*(front[server][0]-1) + front[server][1]*unitHeight/2));
            }

            for (var server in back){
                ctx.fillStyle= "#FF0000";
                ctx.fillRect(horMargin+rackGap+rackWidth,  0.5+Math.round(verMargin + unitHeight*(back[server][0]-1)), rackWidth, 0.5+Math.round(unitHeight*back[server][1]));
                ctx.fillStyle = "black"
                ctx.fillText(server,horMargin+rackGap+rackWidth+rackWidth/2, 0.5+Math.round(verMargin + unitHeight*(back[server][0]-1) + back[server][1]*unitHeight/2));
            }
       }

    </script>
</head>
<body onload="draw();">
<div style="width:100%; overflow: hidden;">
    <div style="float: left;" class="block1">
        <p>{{rack}}</p>
        <p> {{rack.size}} </p>
        <p>{{rack.description}}</p>
        {% if front %}
        <p>FRONT</p>
        {% for t, v in front.items %}
        <p>unit {{t}}: {{v}}</p>
        {% endfor %}
        {% endif %}
        {% if back %}
        <p>BACK</p>
        {% for t, v in back.items %}
        <p>unit {{t}}: {{v}}</p>
        {% endfor %}
        {% endif %}
    </div>

    <div style="margin-left;" class="block2">
        <canvas id="myCanvas" width="200" height="200" style="border: 1px solid #000000;"></canvas>
    </div>
</div>

</body>
</html>